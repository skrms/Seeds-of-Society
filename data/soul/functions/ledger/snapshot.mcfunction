
execute unless block ~ ~-1 ~ minecraft:lectern run tellraw @s {"text":"The Codex whispers: 'Stand upon a lectern to scribe.'","color":"dark_aqua"}
execute unless block ~ ~-1 ~ minecraft:lectern run return 0

scoreboard players set #cons codex.timer 0
execute store result score #cons codex.timer run clear @s minecraft:echo_shard 1
execute if score #cons codex.timer matches 0 run tellraw @s {"text":"The Codex is silent. An Echo Shard is required.","color":"dark_aqua"}
execute if score #cons codex.timer matches 0 run return 0

execute store result storage codex:core ledger.snap int 1 run data get storage codex:core ledger.snap
execute store result score #snap codex.timer run data get storage codex:core ledger.snap
scoreboard players add #snap codex.timer 1
execute store result storage codex:core ledger.snap int 1 run scoreboard players get #snap codex.timer

data modify storage codex:core ledger.book.pages set value []

execute if data storage codex:core ledger.entries[-1] run data modify storage codex:core ledger.book.pages append value '["",{"text":"["},{"storage":"codex:core","nbt":"ledger.entries[-1].outcome","color":"white"},{"text":"] "},{"storage":"codex:core","nbt":"ledger.entries[-1].text","color":"yellow"},{"text":"\nDay "},{"storage":"codex:core","nbt":"ledger.entries[-1].day","color":"gray"},{"text":"  Pos "},{"storage":"codex:core","nbt":"ledger.entries[-1].pos[0]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-1].pos[1]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-1].pos[2]","color":"gray"}]'
execute if data storage codex:core ledger.entries[-2] run data modify storage codex:core ledger.book.pages append value '["",{"text":"["},{"storage":"codex:core","nbt":"ledger.entries[-2].outcome","color":"white"},{"text":"] "},{"storage":"codex:core","nbt":"ledger.entries[-2].text","color":"yellow"},{"text":"\nDay "},{"storage":"codex:core","nbt":"ledger.entries[-2].day","color":"gray"},{"text":"  Pos "},{"storage":"codex:core","nbt":"ledger.entries[-2].pos[0]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-2].pos[1]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-2].pos[2]","color":"gray"}]'
execute if data storage codex:core ledger.entries[-3] run data modify storage codex:core ledger.book.pages append value '["",{"text":"["},{"storage":"codex:core","nbt":"ledger.entries[-3].outcome","color":"white"},{"text":"] "},{"storage":"codex:core","nbt":"ledger.entries[-3].text","color":"yellow"},{"text":"\nDay "},{"storage":"codex:core","nbt":"ledger.entries[-3].day","color":"gray"},{"text":"  Pos "},{"storage":"codex:core","nbt":"ledger.entries[-3].pos[0]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-3].pos[1]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-3].pos[2]","color":"gray"}]'
execute if data storage codex:core ledger.entries[-4] run data modify storage codex:core ledger.book.pages append value '["",{"text":"["},{"storage":"codex:core","nbt":"ledger.entries[-4].outcome","color":"white"},{"text":"] "},{"storage":"codex:core","nbt":"ledger.entries[-4].text","color":"yellow"},{"text":"\nDay "},{"storage":"codex:core","nbt":"ledger.entries[-4].day","color":"gray"},{"text":"  Pos "},{"storage":"codex:core","nbt":"ledger.entries[-4].pos[0]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-4].pos[1]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-4].pos[2]","color":"gray"}]'
execute if data storage codex:core ledger.entries[-5] run data modify storage codex:core ledger.book.pages append value '["",{"text":"["},{"storage":"codex:core","nbt":"ledger.entries[-5].outcome","color":"white"},{"text":"] "},{"storage":"codex:core","nbt":"ledger.entries[-5].text","color":"yellow"},{"text":"\nDay "},{"storage":"codex:core","nbt":"ledger.entries[-5].day","color":"gray"},{"text":"  Pos "},{"storage":"codex:core","nbt":"ledger.entries[-5].pos[0]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-5].pos[1]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-5].pos[2]","color":"gray"}]'
execute if data storage codex:core ledger.entries[-6] run data modify storage codex:core ledger.book.pages append value '["",{"text":"["},{"storage":"codex:core","nbt":"ledger.entries[-6].outcome","color":"white"},{"text":"] "},{"storage":"codex:core","nbt":"ledger.entries[-6].text","color":"yellow"},{"text":"\nDay "},{"storage":"codex:core","nbt":"ledger.entries[-6].day","color":"gray"},{"text":"  Pos "},{"storage":"codex:core","nbt":"ledger.entries[-6].pos[0]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-6].pos[1]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-6].pos[2]","color":"gray"}]'
execute if data storage codex:core ledger.entries[-7] run data modify storage codex:core ledger.book.pages append value '["",{"text":"["},{"storage":"codex:core","nbt":"ledger.entries[-7].outcome","color":"white"},{"text":"] "},{"storage":"codex:core","nbt":"ledger.entries[-7].text","color":"yellow"},{"text":"\nDay "},{"storage":"codex:core","nbt":"ledger.entries[-7].day","color":"gray"},{"text":"  Pos "},{"storage":"codex:core","nbt":"ledger.entries[-7].pos[0]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-7].pos[1]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-7].pos[2]","color":"gray"}]'
execute if data storage codex:core ledger.entries[-8] run data modify storage codex:core ledger.book.pages append value '["",{"text":"["},{"storage":"codex:core","nbt":"ledger.entries[-8].outcome","color":"white"},{"text":"] "},{"storage":"codex:core","nbt":"ledger.entries[-8].text","color":"yellow"},{"text":"\nDay "},{"storage":"codex:core","nbt":"ledger.entries[-8].day","color":"gray"},{"text":"  Pos "},{"storage":"codex:core","nbt":"ledger.entries[-8].pos[0]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-8].pos[1]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-8].pos[2]","color":"gray"}]'
execute if data storage codex:core ledger.entries[-9] run data modify storage codex:core ledger.book.pages append value '["",{"text":"["},{"storage":"codex:core","nbt":"ledger.entries[-9].outcome","color":"white"},{"text":"] "},{"storage":"codex:core","nbt":"ledger.entries[-9].text","color":"yellow"},{"text":"\nDay "},{"storage":"codex:core","nbt":"ledger.entries[-9].day","color":"gray"},{"text":"  Pos "},{"storage":"codex:core","nbt":"ledger.entries[-9].pos[0]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-9].pos[1]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-9].pos[2]","color":"gray"}]'
execute if data storage codex:core ledger.entries[-10] run data modify storage codex:core ledger.book.pages append value '["",{"text":"["},{"storage":"codex:core","nbt":"ledger.entries[-10].outcome","color":"white"},{"text":"] "},{"storage":"codex:core","nbt":"ledger.entries[-10].text","color":"yellow"},{"text":"\nDay "},{"storage":"codex:core","nbt":"ledger.entries[-10].day","color":"gray"},{"text":"  Pos "},{"storage":"codex:core","nbt":"ledger.entries[-10].pos[0]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-10].pos[1]","color":"gray"},{"text":" "},{"storage":"codex:core","nbt":"ledger.entries[-10].pos[2]","color":"gray"}]'

give @s written_book{title:"Codex Ledger â€” Snapshot",author:"The Codex",pages:[{"nbt":"ledger.book.pages[0]","storage":"codex:core","interpret":true},{"nbt":"ledger.book.pages[1]","storage":"codex:core","interpret":true},{"nbt":"ledger.book.pages[2]","storage":"codex:core","interpret":true},{"nbt":"ledger.book.pages[3]","storage":"codex:core","interpret":true},{"nbt":"ledger.book.pages[4]","storage":"codex:core","interpret":true},{"nbt":"ledger.book.pages[5]","storage":"codex:core","interpret":true},{"nbt":"ledger.book.pages[6]","storage":"codex:core","interpret":true},{"nbt":"ledger.book.pages[7]","storage":"codex:core","interpret":true},{"nbt":"ledger.book.pages[8]","storage":"codex:core","interpret":true},{"nbt":"ledger.book.pages[9]","storage":"codex:core","interpret":true}]}
tellraw @s {"text":"The Echo fades into vellum. A snapshot has been scribed.","color":"aqua"}
